# 気象庁からデータをスクレイピングする.
[このサイト](https://www.data.jma.go.jp/obd/stats/etrn/index.php)をスクレーピングしてデータをどこかに永続化する.

## そもそもAPI公開されてないの?
2023/01/05現在, いいAPIは見つかりません.


## csvでダウンロードできるみたいだけど?
できますが, URLが不明なのとダウンロードされてくるcsvがdirtyです.また1時間が最小のデータ取得感覚なので、データの粒度が粗いです.
https://www.data.jma.go.jp/obd/stats/etrn/index.php 
こちらは10分ごとで取れる.

## 目標
**ある1日**における **10 分**ごとの**静岡県**, **浜松**の気象情報を抜き取る.
### 具体的にページのURLを眺めてみる
[ページ例](https://www.data.jma.go.jp/obd/stats/etrn/view/10min_s1.php?prec_no=50&block_no=47654&year=2023&month=01&day=01&view=p1)
```text
https://www.data.jma.go.jp/obd/stats/etrn/view/10min_s1.php?prec_no=50&block_no=47654&year=2023&month=01&day=01&view=p1
```
おそらく
1. 10分ごと: `10min_s1`
2. ある1日:   
   例えば 2023年1月1日の場合 -> `year=2023&month=01&day=01`  
3. 静岡県: `prec_no=50`
4. 浜松: `block_no=47654`

### 他に気にになる部分パラメータ
- クエリパラメータの `view=p1`ってなんだ?  
- 試しにp2にしてみる  
[クエリパラメータp2の場合](https://www.data.jma.go.jp/obd/stats/etrn/view/10min_s1.php?prec_no=50&block_no=47654&year=2023&month=01&day=01&view=p2)
-> 全く変わらないページにアクセスされる.

- `view=p1`なしにする...  
https://www.data.jma.go.jp/obd/stats/etrn/view/10min_s1.php?prec_no=50&block_no=47654&year=2023&month=01&day=01  

- -> 変化なし.
- viewパラメータはデータ量が多すぎるときのページング用と考えて良さそう.
- 今回の場合はデータ量がもともとわかっているので, viewパラメータはなしにする.

### ほしい部分
![img.png](docs/images/img.png)


### コマンドラインで取得してCSV出力する例を作成した

```shell
python main.py --help
```
```text
 Usage: main.py [OPTIONS]                                                                                                                                        
                                                                                                                                                                 
 気象庁の過去データをコマンドラインから実行してCSV形式で取得,(保存する)                                                                                          
                                                                                                                                                                 
╭─ Options ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ *  --date                                TEXT  過去のデータの日付, 例: 2023-01-01 [default: None] [required]                                                  │
│    --dst-path                            PATH  保存するファイルパス [default: None]                                                                           │
│    --location-name                       TEXT  allowed input: ['hamamatsu', 'iwata', 'shizuoka'] [default: hamamatsu]                                         │
│    --every                               TEXT  データの取得間隔 allowed input: ['10m'] [default: 10m]                                                         │
│    --save-local       --no-save-local          ローカルに保存するかどうか. dst_pathを指定しなかった場合: "{YYYY-mm-dd}__{location_name}__every_{every}.csv"   │
│                                                YYYY-mm-dd はdateで指定した引数 という名前でカレントディレクトリに保存する.                                    │
│                                                [default: no-save-local]                                                                                       │
│    --echo             --no-echo                標準出力に出力するかどうか [default: echo]                                                                     │
│    --help                                      Show this message and exit.                                                                                    │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
```

### 実行例

```shell
python main.py --date 2023-01-01 --location-name hamamatsu
```

```text
浜松-hamamatsu
Fetching this url: https://www.data.jma.go.jp/obd/stats/etrn/view/10min_s1.php?prec_no=50&block_no=47654&year=2023&month=1&day=1
```
```csv
時分,現地_気圧(hPa),海面_気圧(hPa),降水量(mm),気温(ºC),相対湿度(%),平均_風速(m/s),平均_風向,最大瞬間_風速(m/s),最大瞬間_風向,日照時間(min)
00:10,1017.2,1023.1,--,6.5,61,4.3,西北西,6.8,西北西,
00:20,1017.2,1023.1,--,6.2,62,4.7,西北西,7.1,西北西,
00:30,1017.1,1023.0,--,6.1,62,4.5,西北西,6.5,西北西,
00:40,1017.1,1023.0,--,6.0,63,3.7,西北西,6.6,西北西,
00:50,1017.2,1023.1,--,6.1,63,3.8,西北西,5.9,西,
01:00,1017.2,1023.1,--,6.0,63,3.6,西北西,5.2,西,
01:10,1017.2,1023.1,--,5.8,63,3.3,西北西,4.9,西北西,
01:20,1017.2,1023.1,--,5.8,63,3.1,西北西,4.8,西北西,
01:30,1017.3,1023.2,--,5.7,63,2.9,西北西,4.7,西北西,
01:40,1017.3,1023.2,--,5.4,64,2.7,西北西,4.2,北西,
01:50,1017.3,1023.2,--,5.4,64,2.5,西北西,3.8,西北西,
02:00,1017.4,1023.4,--,5.2,64,1.9,北西,3.4,北西,
02:10,1017.3,1023.3,--,5.1,64,1.6,北西,2.8,西北西,
02:20,1017.2,1023.2,--,4.9,64,1.7,北西,2.9,西北西,
02:30,1017.1,1023.1,--,4.8,65,1.8,北西,3.5,北西,
02:40,1017.1,1023.1,--,5.0,65,2.1,北西,3.3,北西,
02:50,1017.2,1023.2,--,4.9,65,2.4,西北西,3.7,西北西,
03:00,1017.2,1023.2,--,4.9,64,2.7,西北西,4.4,北西,
03:10,1017.3,1023.3,--,4.8,65,2.8,西北西,4.1,西北西,
03:20,1017.4,1023.4,--,4.8,65,2.9,西北西,4.8,西北西,
03:30,1017.4,1023.4,--,4.7,65,3.4,西北西,4.7,西北西,
03:40,1017.4,1023.4,--,4.7,65,3.1,西北西,4.7,西北西,
03:50,1017.3,1023.3,--,5.1,63,3.9,西北西,5.9,西北西,
04:00,1017.3,1023.3,--,5.1,62,3.9,西北西,5.4,西北西,
04:10,1017.2,1023.1,--,5.2,62,4.0,西北西,6.1,西北西,
04:20,1017.2,1023.1,--,5.5,61,4.4,西北西,6.3,西北西,
04:30,1017.2,1023.1,--,5.5,61,4.5,西北西,7.7,西北西,
04:40,1017.2,1023.1,--,5.5,60,4.7,西北西,7.9,西北西,
04:50,1017.3,1023.2,--,5.4,61,4.8,西北西,7.8,西北西,
05:00,1017.3,1023.2,--,5.2,62,4.3,西北西,6.3,西北西,
05:10,1017.4,1023.4,--,5.2,63,3.7,西北西,5.9,北西,
05:20,1017.3,1023.3,--,4.7,65,2.9,西,4.2,西,
05:30,1017.5,1023.5,--,4.7,65,3.1,西北西,4.7,西北西,
05:40,1017.5,1023.5,--,4.6,66,2.7,西北西,4.6,西北西,
05:50,1017.6,1023.6,--,4.5,67,2.8,西北西,4.0,西北西,
06:00,1017.6,1023.6,--,4.4,68,2.9,西北西,4.6,西北西,
06:10,1017.6,1023.6,--,4.4,68,2.9,西北西,4.4,西,
06:20,1017.6,1023.6,--,4.3,69,3.0,西北西,4.4,西,
06:30,1017.7,1023.7,--,4.2,69,3.1,西北西,4.6,西,
06:40,1017.8,1023.8,--,4.4,69,3.0,西北西,4.8,西,
06:50,1017.8,1023.8,--,4.4,69,3.1,西北西,5.1,西北西,
07:00,1017.7,1023.7,--,4.3,69,2.7,西北西,4.4,西北西,0.0
07:10,1017.7,1023.7,--,4.3,69,2.7,西北西,3.6,北西,5.0
07:20,1017.7,1023.7,--,4.5,68,2.7,西北西,4.1,西北西,10.0
07:30,1017.8,1023.8,--,4.7,67,3.1,西北西,4.6,西北西,10.0
07:40,1017.8,1023.8,--,5.0,66,3.8,西,5.2,西北西,10.0
07:50,1017.8,1023.8,--,5.3,65,3.8,西,5.3,西,10.0
08:00,1017.9,1023.8,--,5.4,64,3.7,西,5.7,西,10.0
08:10,1017.7,1023.6,--,5.7,64,3.2,西,4.6,西北西,10.0
08:20,1017.8,1023.7,--,6.1,63,3.6,西,5.9,西,10.0
08:30,1017.9,1023.8,--,6.4,61,4.3,西,6.3,西,10.0
08:40,1017.9,1023.8,--,6.8,61,3.1,西,5.1,西北西,10.0
08:50,1017.8,1023.7,--,7.0,59,3.6,西,6.0,西北西,10.0
09:00,1017.9,1023.8,--,7.3,59,4.1,西,6.3,西,10.0
09:10,1017.8,1023.7,--,7.5,57,4.1,西,6.1,西,10.0
09:20,1017.7,1023.6,--,7.8,57,4.2,西,6.7,西,10.0
09:30,1017.5,1023.4,--,8.0,57,4.3,西,8.0,西,10.0
09:40,1017.4,1023.3,--,8.1,56,5.0,西,9.6,西,10.0
09:50,1017.4,1023.3,--,8.2,56,5.2,西,9.1,西,10.0
10:00,1017.4,1023.3,--,8.4,56,5.6,西,9.0,西,10.0
10:10,1017.3,1023.2,--,8.5,55,5.3,西,9.4,西,10.0
10:20,1017.1,1023.0,--,9.1,55,4.8,西南西,8.7,西南西,10.0
10:30,1016.9,1022.8,--,9.4,54,4.9,西南西,8.4,西南西,10.0
10:40,1016.7,1022.6,--,9.5,53,5.6,西,10.7,西,10.0
10:50,1016.5,1022.4,--,9.4,53,6.1,西,9.9,西,10.0
11:00,1016.3,1022.2,--,9.3,54,6.9,西,10.9,西,10.0
11:10,1016.0,1021.8,--,9.7,52,6.0,西,9.0,西,10.0
11:20,1015.8,1021.6,--,9.8,52,7.5,西,12.1,西北西,10.0
11:30,1015.6,1021.4,--,10.3,50,7.2,西,11.0,西北西,10.0
11:40,1015.5,1021.3,--,10.3,49,7.3,西北西,10.6,西,10.0
11:50,1015.4,1021.2,--,10.6,48,6.9,西北西,10.1,西北西,10.0
12:00,1015.2,1021.0,--,10.9,47,6.6,西北西,12.1,西北西,10.0
12:10,1015.0,1020.8,--,10.7,48,7.7,西北西,11.8,西,10.0
12:20,1014.8,1020.6,--,10.9,47,8.1,西北西,13.1,西,10.0
12:30,1014.5,1020.3,--,10.9,45,8.1,西北西,12.4,西北西,10.0
12:40,1014.4,1020.2,--,11.1,44,7.6,西北西,13.0,西北西,10.0
12:50,1014.4,1020.2,--,11.2,45,8.2,西北西,12.8,西北西,10.0
13:00,1014.3,1020.1,--,11.2,43,7.1,西北西,11.2,北西,10.0
13:10,1014.1,1019.9,--,11.4,43,6.9,西北西,12.3,西北西,10.0
13:20,1014.1,1019.9,--,11.4,44,6.7,西北西,13.2,西北西,10.0
13:30,1014.0,1019.8,--,11.4,44,6.9,西北西,12.6,西北西,10.0
13:40,1013.9,1019.7,--,11.5,45,5.7,西北西,9.6,西北西,10.0
13:50,1013.8,1019.6,--,11.1,45,6.7,西北西,10.7,西,10.0
14:00,1013.9,1019.7,--,11.0,46,8.0,西,12.0,西北西,10.0
14:10,1014.0,1019.8,--,11.2,45,6.9,西,12.1,西,10.0
14:20,1014.0,1019.8,--,11.3,44,6.9,西北西,12.1,西北西,10.0
14:30,1014.1,1019.9,--,11.1,44,6.9,西北西,13.1,西北西,10.0
14:40,1014.1,1019.9,--,11.5,43,5.1,西北西,10.5,北西,10.0
14:50,1014.2,1020.0,--,11.1,44,7.8,西北西,14.2,西,10.0
15:00,1014.2,1020.0,--,11.1,44,7.7,西北西,12.2,西北西,10.0
15:10,1014.3,1020.1,--,10.8,45,8.2,西北西,12.9,西,10.0
15:20,1014.5,1020.3,--,10.8,45,7.9,西北西,12.5,西北西,10.0
15:30,1014.6,1020.4,--,10.5,46,7.0,西北西,11.5,西,5.0
15:40,1014.7,1020.5,--,10.3,47,6.8,西北西,12.3,西,0.0
15:50,1014.8,1020.6,--,10.4,48,5.2,西北西,8.6,西,3.0
16:00,1014.8,1020.6,--,10.1,49,6.1,北西,11.2,北西,10.0
16:10,1014.7,1020.5,--,9.8,50,5.7,西北西,9.8,西北西,10.0
16:20,1014.9,1020.7,--,9.7,51,5.6,西北西,11.0,西北西,10.0
16:30,1014.9,1020.7,--,9.4,52,5.7,西北西,10.2,西北西,1.0
16:40,1015.0,1020.8,--,9.2,52,6.6,西北西,12.7,西北西,0.0
16:50,1015.1,1020.9,--,9.2,52,6.9,西北西,12.0,西北西,0.0
17:00,1015.3,1021.2,--,9.0,54,6.0,西北西,10.5,北西,
17:10,1015.3,1021.2,--,8.8,55,5.5,西北西,10.0,西北西,
17:20,1015.5,1021.4,--,8.7,55,4.6,北西,8.5,西北西,
17:30,1015.6,1021.5,--,8.5,56,4.2,西北西,7.1,北西,
17:40,1015.6,1021.5,--,8.4,56,3.7,北西,7.5,北西,
17:50,1015.7,1021.6,--,8.3,57,4.0,西北西,7.2,北西,
18:00,1015.7,1021.6,--,8.2,57,3.5,北西,6.9,北西,
18:10,1015.7,1021.6,--,8.2,57,3.3,北西,6.4,北西,
18:20,1015.8,1021.7,--,8.3,56,4.1,北西,8.2,北西,
18:30,1015.8,1021.7,--,8.3,56,4.2,北西,9.1,西北西,
18:40,1015.8,1021.7,--,8.1,57,3.2,北西,6.1,西北西,
18:50,1015.9,1021.8,--,8.3,56,4.2,北西,7.8,北西,
19:00,1015.8,1021.7,--,8.4,55,4.6,北西,8.0,西北西,
19:10,1015.7,1021.6,--,8.5,54,5.4,北西,11.8,北西,
19:20,1015.5,1021.4,--,8.4,55,5.0,西北西,9.7,西北西,
19:30,1015.5,1021.4,--,8.4,56,4.9,北西,8.7,北西,
19:40,1015.3,1021.2,--,8.2,57,4.4,北西,7.7,西北西,
19:50,1015.2,1021.1,--,8.2,58,4.7,北西,8.5,北西,
20:00,1015.0,1020.9,--,7.9,59,3.1,北西,7.6,西北西,
20:10,1015.0,1020.9,--,7.8,60,3.1,西北西,6.4,西北西,
20:20,1015.2,1021.1,--,7.7,61,3.7,西北西,6.0,西北西,
20:30,1015.5,1021.4,--,7.7,62,4.5,西北西,8.6,西北西,
20:40,1015.5,1021.4,--,7.7,62,4.6,西北西,7.1,西北西,
20:50,1015.5,1021.4,--,7.6,62,4.4,西北西,7.6,西北西,
21:00,1015.5,1021.4,--,7.5,63,4.2,西北西,6.7,西,
21:10,1015.4,1021.3,--,7.4,63,3.7,西北西,6.5,西北西,
21:20,1015.4,1021.3,--,7.3,63,3.6,西,7.0,西北西,
21:30,1015.6,1021.5,--,7.0,64,3.5,西,5.7,西,
21:40,1015.6,1021.5,--,7.1,65,3.8,西,6.4,西,
21:50,1015.6,1021.5,--,7.2,64,4.4,西,7.6,西,
22:00,1015.3,1021.2,--,7.3,64,5.0,西,9.8,西北西,
22:10,1015.3,1021.2,--,7.4,63,5.9,西,9.3,西北西,
22:20,1015.3,1021.2,--,7.3,64,5.6,西,8.9,西北西,
22:30,1015.2,1021.1,--,7.1,64,5.1,西,10.0,西北西,
22:40,1015.1,1021.0,--,6.8,66,4.4,西,7.6,西,
22:50,1015.2,1021.1,--,7.0,65,4.2,西,7.1,西,
23:00,1015.2,1021.1,--,6.9,65,4.0,西,6.3,西北西,
23:10,1015.1,1021.0,--,7.0,65,3.9,西,6.1,西,
23:20,1015.1,1021.0,--,6.6,66,3.7,西,6.3,西,
23:30,1015.0,1020.9,--,6.4,68,3.8,西,6.2,西,
23:40,1014.9,1020.8,--,6.6,67,4.4,西,6.6,西,
23:50,1014.9,1020.8,--,6.5,67,4.1,西,6.6,西,
24:00,1014.9,1020.8,--,6.3,68,3.7,西,6.0,西,


```
